<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
	<!--<![endif]-->

	<head>
		<meta charset="utf-8">
		<title>Neutrino Software Load Balancer</title>
		<meta name="description" content="Highly Modular, Customizable and Efficent Software Load Balancer">
		<script src="//load.sumome.com/" data-sumo-site-id="2a7554daf78b7e18bc894bcf0491732202d3cbea097a83ec97e34ed32e86cef6" async="async"></script>
		<meta name="author" content="htmlcoder.me">

		<!-- Mobile Meta -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Favicon -->
		<link rel="shortcut icon" href="images/favicon.ico">

		<!-- Web Fonts -->
		<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic,500,500italic,700,700italic' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Raleway:700,400,300' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>

		<!-- Bootstrap core CSS -->
		<link href="bootstrap/css/bootstrap.css" rel="stylesheet">

		<!-- Font Awesome CSS -->
		<link href="fonts/font-awesome/css/font-awesome.css" rel="stylesheet">

		<!-- Fontello CSS -->
		<link href="fonts/fontello/css/fontello.css" rel="stylesheet">

		<!-- Plugins -->
		<link href="plugins/magnific-popup/magnific-popup.css" rel="stylesheet">
		<link href="plugins/rs-plugin/css/settings.css" rel="stylesheet">
		<link href="css/animations.css" rel="stylesheet">
		<link href="plugins/owl-carousel/owl.carousel.css" rel="stylesheet">
		<link href="plugins/owl-carousel/owl.transitions.css" rel="stylesheet">
		<link href="plugins/hover/hover-min.css" rel="stylesheet">		

		<!-- the project core CSS file -->
		<link href="css/style.css" rel="stylesheet" >

		<!-- Color Scheme (In order to change the color scheme, replace the blue.css with the color scheme that you prefer)-->
		<link href="css/skins/light_blue.css" rel="stylesheet">

		<!-- Custom css --> 
		<link href="css/custom.css" rel="stylesheet">
	</head>

	<!-- body classes:  -->
	<!-- "boxed": boxed layout mode e.g. <body class="boxed"> -->
	<!-- "pattern-1 ... pattern-9": background patterns for boxed layout mode e.g. <body class="boxed pattern-1"> -->
	<!-- "transparent-header": makes the header transparent and pulls the banner to top -->
	<!-- "page-loader-1 ... page-loader-6": add a page loader to the page (more info @components-page-loaders.html) -->
	<body class="no-trans front-page  page-loader-4">
	
	<header class="header  fixed  dark clearfix">
					
					<div class="container">
						<div class="row">
							<div class="col-md-3">
								<!-- header-left start -->
								<!-- ================ -->
								<div class="header-left clearfix">

									<!-- logo -->
									<div id="logo" class="logo">
										<a href="neutrino-landing.html"><img id="logo_img" src="images/logo.png" alt="The Project"></a>
										
									</div>

									<div class="site-slogan">
										Software Load Balancer
									</div>
									
								</div>
								<!-- header-left end -->

							</div>
							<div class="col-md-9">
					
								<!-- header-right start -->
								<!-- ================ -->
								<div class="header-right clearfix">
									
								<!-- main-navigation start -->
								<!-- classes: -->
								<!-- "onclick": Makes the dropdowns open on click, this the default bootstrap behavior e.g. class="main-navigation onclick" -->
								<!-- "animated": Enables animations on dropdowns opening e.g. class="main-navigation animated" -->
								<!-- "with-dropdown-buttons": Mandatory class that adds extra space, to the main navigation, for the search and cart dropdowns -->
								<!-- ================ -->
								<div class="main-navigation  animated with-dropdown-buttons">

									<!-- navbar start -->
									<!-- ================ -->
									<nav class="navbar navbar-default" role="navigation">
										<div class="container-fluid">

											<!-- Toggle get grouped for better mobile display -->
											<div class="navbar-header">
												<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
													<span class="sr-only">Toggle navigation</span>
													<span class="icon-bar"></span>
													<span class="icon-bar"></span>
													<span class="icon-bar"></span>
												</button>
												
											</div>

											<!-- Collect the nav links, forms, and other content for toggling -->
											<div class="collapse navbar-collapse" id="navbar-collapse-1">
												<!-- main-menu -->
												<ul class="nav navbar-nav ">

													
													<li class="dropdown ">
														<a href="neutrino-landing.html" class="dropdown-toggle" data-toggle="dropdown">Home</a>
														<ul class="dropdown-menu">
															<li ><a href="neutrino-landing.html#why">Why Neutrino</a></li>
															<li ><a href="neutrino-landing.html#comparison">When to use Neutrino</a></li>
															
														</ul>
													</li>
													<li class="dropdown ">
														<a href="neutrino-doc.html#main" class="dropdown-toggle" data-toggle="dropdown">Docs</a>
														<ul class="dropdown-menu">
															<li ><a href="neutrino-doc.html#main">High Level Design</a></li>
															<li ><a href="neutrino-doc.html#pipeline">PipeLine Architecture</a></li>
															<li ><a href="neutrino-doc.html#poolresolvers">Pool Resolvers</a></li>
															<li ><a href="neutrino-doc.html#poolbalancers">Pool Balancers</a></li>
															
														</ul>
													</li>
													
													<li class="dropdown ">
														<a href="neutrino-howto.html" class="dropdown-toggle" data-toggle="dropdown">How to start</a>
														<ul class="dropdown-menu">
															<li ><a href="neutrino-howto.html">Starting SLB</a></li>
															<li ><a href="neutrino-howto.html#dynamicconfig">Dynamic configuration</a></li>
															<li ><a href="neutrino-howto.html#multiportconfig">Multiport Configuration</a></li>
															<li ><a href="neutrino-howto.html#graphite">Graphite Integration</a></li>
															<li ><a href="neutrino-howto.html#netty">Netty Thread Configuration</a></li>
														</ul>
													</li>
													
													<li class="dropdown ">
														<a href="neutrino-metricsandapi.html#metrics" class="dropdown-toggle" data-toggle="dropdown">Metrics and API</a>
														<ul class="dropdown-menu">
															<li ><a href="neutrino-metricsandapi.html#metrics">Overview</a></li>
															<li ><a href="neutrino-metricsandapi.html#Pools">Pools</a></li>
															<li ><a href="neutrino-metricsandapi.html#Servers">Servers</a></li>
															<li ><a href="neutrino-metricsandapi.html#reload">Reload</a></li>
														</ul>
													</li>
													
													<li class="dropdown ">
														<a href="neutrino-howto.html#contributions" class="dropdown-toggle" data-toggle="dropdown">About</a>
														<ul class="dropdown-menu">
															<li ><a href="neutrino-faq.html">FAQ</a></li>
															<li ><a href="neutrino-howto.html#contributions">Contributions</a></li>
															
														</ul>
													</li>
													
												</ul>
												<!-- main-menu end -->
												
												
												<!-- header dropdown buttons end-->
												
											</div>

										</div>
									</nav>
									<!-- navbar end -->

								</div>
								<!-- main-navigation end -->	
								</div>
								<!-- header-right end -->
					
							</div>
						</div>
					</div>
					
				</header>

		<!-- scrollToTop -->
		<!-- ================ -->
		<div class="scrollToTop circle"><i class="icon-up-open-big"></i></div>
		
		<!-- page wrapper start -->
		<!-- ================ -->
		<div class="page-wrapper">
		
			<!-- header-container start -->
			
		

			<!-- main-container start -->
			<!-- ================ -->
			<section class="main-container">

				<div class="container">
					<div class="row">

						<!-- main start -->
						<!-- ================ -->
						<div id="highlevel" class="main col-md-8">

							<!-- page-title start -->
							<!-- ================ -->
						
							
							
							<!-- page-title end -->

							<!-- blogpost start -->
							<article class="blogpost">
								<div id="carousel-blog-post" class="carousel slide" data-ride="carousel">
									<!-- Indicators -->
									<ol class="carousel-indicators bottom margin-clear">
										<li data-target="#carousel-blog-post" data-slide-to="0" class="active"></li>
										<li data-target="#carousel-blog-post" data-slide-to="1"></li>
										<li data-target="#carousel-blog-post" data-slide-to="2"></li>
									</ol>

									<!-- Wrapper for slides -->
									
								<header>
									<h2>Neutrino</a></h2>
									
								</header>
								<div class="blogpost-content">
									<p class="lead">Data Center consists of multiple levels of Load Balancing. It starts with Web Tier load balancer which will take the traffic from the internet and pass the traffic to mid tier load balancers. Web Tier load balancers usually are dedicated costly machines brought from the market. It is in the mid tier load balancers, Software Load Balancer(SLB) would fit in. SLB can run Bare Metals, VM or Docker containers and it is open source, so it is cost effective to scale horizontally. All SLB instances will contain all the routing rules and it can be either pushed or pulled from a central repository. Updating the routing rules doesn't affect the existing connection, so frequent updation won't affect the reliability of the system.</p>
									
								</div>
								
								<img src="images/SLB HighLevel.png" alt="">
								
							</article>
							
							<!-- blogpost start -->
							<article class="blogpost">
								<div id="carousel-blog-post" class="carousel slide" data-ride="carousel">
									<!-- Indicators -->
									<ol class="carousel-indicators bottom margin-clear">
										<li data-target="#carousel-blog-post" data-slide-to="0" class="active"></li>
										<li data-target="#carousel-blog-post" data-slide-to="1"></li>
										<li data-target="#carousel-blog-post" data-slide-to="2"></li>
									</ol>

									<!-- Wrapper for slides -->
									
								<header>
									<h2>Pipeline Architecture</a></h2>
									
								</header>
								<div class="blogpost-content">
									<p>Request and Response Pipeline is an important feature of SLB. It makes the SLB modular and pluggable.</p>
									<p>Netty is a NIO client server framework which enables quick and easy development of network applications such as protocol servers and clients. Netty ChannelPipeline architecture. ChannelPipeline implements an advanced form of the Intercepting Filter pattern to give a user full control over how an event is handled and how the ChannelHandlers in a pipeline interact with each other.</p>
									<p>Pros</p>
									
									<ul>
									  <li>Proven Pipeline technology</li>
									  <li type="square">Extensive documentation (User Guide, How-to, Blogs, Books)</li>
									  <li>Fully asynchronous and event-driven</li>
									  <li>Handlers can operate on raw bytes (ByteBuf)</li>
									  <li>Flexible factory pattern for creating a pipeline</li>
									  <li>Built-in support for short circuiting a pipeline handler by specifying a timeout for handler processing in Netty 4.</li>
									</ul>
   
								</div>
								
								<img src="images/Pipeline.png" alt="">
								
							</article>
							<!-- blogpost start -->
							<article id="pipeline" class="blogpost">
								<header>
									<h2>Adding new handler in PipeLine</a></h2>
									
								</header>
								<div class="blogpost-content">
									<p>Adding a new Handler in the pipe line is pretty simple. Following is sample code which adds a handler which will print all incoming URLs</p>
									<pre><code class="java">
import com.ebay.neutrino.NeutrinoRequest;
import io.netty.channel.ChannelDuplexHandler;
import io.netty.channel.ChannelHandler;
import io.netty.channel.ChannelHandlerContext;

/**
 * Created by blpaul on 11/10/2015.
 */
@ChannelHandler.Sharable
public class NeutrinoSampleHandler extends ChannelDuplexHandler {

	@Override
	public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {
		if (msg instanceof NeutrinoRequest) {
			NeutrinoRequest request = (NeutrinoRequest) msg;
			System.out.println(request.requestUri());

		}
		ctx.fireChannelRead(msg);
	}

}
									</code></pre>
									
									<p>Initialize the handler in NeutrinoServiceInitializer.scala </p>
									<pre><code class="java">
val timeout = new ChannelTimeoutHandler(settings.timeouts)
//Initializing the new Handler
val sampleHandler = new NeutrinoSampleHandler();

									
pipeline.addLast("user-pipeline", user)


//Adding the new Handler
pipeline.addLast("sampleHandler", sampleHandler)

// Final handler will reroute inbound to our downstream, as available
pipeline.addLast("downstream", downstream)
									</code></pre>
								</div>
							
							</article>
							<!-- blogpost end -->
							
							<!-- blogpost start -->
							<article  id="poolresolvers" class="blogpost">
								<header>
									<h2>PoolResolvers</a></h2>
								
								</header>
								<div class="blogpost-content">
									<p>PoolResolvers are used to resolve a request to pool. Supported pool resolvers are CNameResolver and L7AddressResolver. CNameResolver resolves the request to a pool based on the Canonical name(cname) while L7AddressResolverresolves the request based cname and url postfix.</p>
									<p>Below is a sample code for adding a resolver for 2FA. If the 2FA token is missing in the header, Neutrino will redirect the request to a 2FA server
									<pre><code class="java">
import com.ebay.neutrino.*;

import com.ebay.neutrino.config.VirtualPool;
import scala.None;
import scala.Option;
import scala.collection.concurrent.TrieMap;

import java.util.List;

import static com.ebay.neutrino.config.Transport$.*;

/**
 * Created by blpaul on 11/10/2015.
 */

public class TwoFAResolver implements PoolResolver {

    private Integer version = 0;

    private NeutrinoPool twofaPool;

    @Override
    public Option<NeutrinoPool> resolve(NeutrinoPools pools, NeutrinoRequest request) {

		// Cache the twofaPool 
        if (version != pools.version()) {
            version = pools.version();
            NeutrinoPoolId neutrinoId;
            // Since Transport is sealed trait, we have access with MODULE in java
            neutrinoId = new NeutrinoPoolId("twofa", MODULE$.apply("http"));
            twofaPool  = pools.pools().get(neutrinoId).get();


        }
        String token = request.headers().get("TOKEN");

        Option<NeutrinoPool> neutrinoPoolOption = Option.apply(null);
		
		// Validate the token
        Boolean validated = true;
        if (validated == false) {
            neutrinoPoolOption = Option.apply(twofaPool);
            return neutrinoPoolOption;
        }

        return neutrinoPoolOption;

    }
}
									</code></pre>
									
									<p>Initialize the pool resolver in NeutrinoPoolResolver.scala</p>
									<pre><code class="java">
 case "layerseven"   => new L7AddressResolver
 case "twofa"   => new TwoFAResolver
									</code></pre>
									
									<p>Select the pool resolver for the configuration</p>
									<pre><code class="java">
listeners = [
    {
      # Should try cname and then skip to default
      pool-resolver = ["twofa", "cname", "layerseven"],
      port = 9080,
      port-alias = 80,
      protocol = "http"
    }
  ]
  .....
  .....
    pools = [
    { id = "twofa", protocol = "http", ...
									</code></pre>
								</div>
							
							</article>
							<!-- blogpost end -->
							
							<!-- blogpost start -->
							<article  id="poolbalancers" class="blogpost">
								<header>
									<h2><a href="blog-post.html">Pool Balancers</a></h2>
									<div class="post-info">
										
									</div>
								</header>
								<div class="blogpost-content">
									<p>Pool Balancers are used to manage the traffic between individual VMs in the pool and it can configured for each pool. Currently, there is support for both RoundRobin and LeastConnection Balancers</p>
									<p>Below is sample code for adding a Round Robin Pool Balancer</p>
									<pre><code class="java">
import com.ebay.neutrino.{NeutrinoNode, NeutrinoRequest}


class RoundRobinBalancer extends Balancer {

  type Entry = NeutrinoNode

  private val members = new BalancerNodes[Entry]()
  private var iter = members.available.iterator


  // Re(set) the current membership of the load-balancer
  override def rebuild(members: Array[NeutrinoNode]) =
    this.members.set(members, identity)


  // Resolve an endpoint for request processing
  def assign(request: NeutrinoRequest): Option[NeutrinoNode] =
    if (members.isEmpty)
      None
    else
      // Store the active iterator
      members.synchronized {
        if (iter.isEmpty) iter = members.available.iterator
        if (iter.hasNext) Option(iter.next._1)
        else None
      }

  // Release an endpoint from request processing
  def release(request: NeutrinoRequest, node: NeutrinoNode) = {}

}									</code></pre>
									
									<p>Initialize the balancer in BalancerSettings.scala </p>
									<pre><code class="java">
val RoundRobin = BalancerSettings(classOf[RoundRobinBalancer], None)
....
....
 def apply(balancer: String): BalancerSettings =
    balancer toLowerCase match {
      case "rr" | "round-robin" => RoundRobin
									</code></pre>
									
									<p>Add the new Balancer to the pool </p>
									<pre><code class="java">
pools = [
  { id = "twofa", protocol = "http", balancer = "round-robin",
									</code></pre>
								</div>
							
							</article>
							<!-- blogpost end -->

							
							<!-- pagination end -->

						</div>
						<!-- main end -->

						<!-- sidebar start -->
						<!-- ================ -->
						<aside class="col-md-4 col-lg-3 col-lg-offset-1">
							<div class="sidebar">
								<div class="block clearfix">
									<h3 class="title">Sidebar menu</h3>
									<div class="separator-2"></div>
									<nav>
										<ul class="nav nav-pills nav-stacked">
											<li class="active"><a href="neutrino-landing.html">Home</a></li>
											<li class="active"><a href="neutrino-doc.html#pipeline">PipeLine Architecture</a></li>
											<li class="active"><a href="neutrino-doc.html#poolresolvers">Pool Resolvers</a></li>
											<li class="active"><a href="neutrino-doc.html#poolbalancers">Pool Balancers</a></li>
											
										</ul>
									</nav>
								</div>
								
															
							
							</div>
						</aside>
						<!-- sidebar end -->

					</div>
				</div>
			</section>
			<!-- main-container end -->

			<!-- footer top start -->
			<!-- ================ -->

			<!-- footer top end -->
			<!-- footer start (Add "dark" class to #footer in order to enable dark footer) -->
			<!-- ================ -->
			<footer id="footer" class="clearfix ">

				

				<!-- .subfooter start -->
				<!-- ================ -->
				<div class="subfooter">
					<div class="container">
						<div class="subfooter-inner">
							<div class="row">
								<div class="col-md-12">
								    <p class="text-center">Code licensed under Apache License v2.0, documentation and video under CC BY 3.0. </p>
									<p class="text-center">© 2015 Neutrino by <a target="_blank" href="http://ebay.com">eBay Software Foundation</a>. All Rights Reserved</p>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- .subfooter end -->

			</footer>
			<!-- footer end -->
			
		</div>
		<!-- page-wrapper end -->

		<!-- JavaScript files placed at the end of the document so the pages load faster -->
		<!-- ================================================== -->
		<!-- Jquery and Bootstap core js files -->
		<script type="text/javascript" src="plugins/jquery.min.js"></script>
		<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>

		<!-- Modernizr javascript -->
		<script type="text/javascript" src="plugins/modernizr.js"></script>

		<!-- jQuery Revolution Slider  -->
		<script type="text/javascript" src="plugins/rs-plugin/js/jquery.themepunch.tools.min.js"></script>
		<script type="text/javascript" src="plugins/rs-plugin/js/jquery.themepunch.revolution.min.js"></script>

		<!-- Isotope javascript -->
		<script type="text/javascript" src="plugins/isotope/isotope.pkgd.min.js"></script>
		
		<!-- Magnific Popup javascript -->
		<script type="text/javascript" src="plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
		
		<!-- Appear javascript -->
		<script type="text/javascript" src="plugins/waypoints/jquery.waypoints.min.js"></script>

		<!-- Count To javascript -->
		<script type="text/javascript" src="plugins/jquery.countTo.js"></script>
		
		<!-- Parallax javascript -->
		<script src="plugins/jquery.parallax-1.1.3.js"></script>

		<!-- Contact form -->
		<script src="plugins/jquery.validate.js"></script>

		<!-- Background Video -->
		<script src="plugins/vide/jquery.vide.js"></script>

		<!-- Owl carousel javascript -->
		<script type="text/javascript" src="plugins/owl-carousel/owl.carousel.js"></script>
		
		<!-- Pace javascript -->
		<script type="text/javascript" src="plugins/pace/pace.min.js"></script>

		<!-- SmoothScroll javascript -->
		<script type="text/javascript" src="plugins/jquery.browser.js"></script>
		<script type="text/javascript" src="plugins/SmoothScroll.js"></script>

		<!-- Initialization of Plugins -->
		<script type="text/javascript" src="js/template.js"></script>

		<!-- Custom Scripts -->
		<script type="text/javascript" src="js/custom.js"></script>
	</body>
</html>
